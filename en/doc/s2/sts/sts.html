
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>STS Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../offline/offline-api.html" />
    
    
    <link rel="prev" href="../object/list_parts.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../../intro/overview/">
            
                <a href="../../../intro/overview/">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../../faq-pub.html">
            
                <a href="../../../faq-pub.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../">
            
                <a href="../">
            
                    
                    Object Storage Service
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../demo/">
            
                <a href="../demo/">
            
                    
                    Amazon SDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../demo/python.html">
            
                <a href="../demo/python.html">
            
                    
                    Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../demo/php.html">
            
                <a href="../demo/php.html">
            
                    
                    PHP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="../demo/phpv2.html">
            
                <a href="../demo/phpv2.html">
            
                    
                    PHPV2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="../demo/browser.html">
            
                <a href="../demo/browser.html">
            
                    
                    Browser
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="../demo/nodejs.html">
            
                <a href="../demo/nodejs.html">
            
                    
                    Nodejs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.6" data-path="../demo/java.html">
            
                <a href="../demo/java.html">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.7" data-path="../demo/go.html">
            
                <a href="../demo/go.html">
            
                    
                    Go
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.8" data-path="../demo/dotnet.html">
            
                <a href="../demo/dotnet.html">
            
                    
                    Dotnet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../limitation/limit.html">
            
                <a href="../limitation/limit.html">
            
                    
                    Limitation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../signature/signature.html">
            
                <a href="../signature/signature.html">
            
                    
                    Signature
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../acl/acl.html">
            
                <a href="../acl/acl.html">
            
                    
                    ACL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../service/">
            
                <a href="../service/">
            
                    
                    Service
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../service/buckets_list.html">
            
                <a href="../service/buckets_list.html">
            
                    
                    LIST Buckets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../bucket/">
            
                <a href="../bucket/">
            
                    
                    Bucket
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.6.1" data-path="../bucket/get_bucket_list_objects.html">
            
                <a href="../bucket/get_bucket_list_objects.html">
            
                    
                    GET Bucket or List Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.2" data-path="../bucket/put_bucket.html">
            
                <a href="../bucket/put_bucket.html">
            
                    
                    PUT Bucket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.3" data-path="../bucket/delete_bucket.html">
            
                <a href="../bucket/delete_bucket.html">
            
                    
                    DELETE Bucket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.4" data-path="../bucket/put_bucket_acl.html">
            
                <a href="../bucket/put_bucket_acl.html">
            
                    
                    PUT Bucket ACL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6.5" data-path="../bucket/get_bucket_acl.html">
            
                <a href="../bucket/get_bucket_acl.html">
            
                    
                    GET Bucket ACL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../object/">
            
                <a href="../object/">
            
                    
                    Object
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.1" data-path="../object/head_object.html">
            
                <a href="../object/head_object.html">
            
                    
                    HEAD Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.2" data-path="../object/get_object.html">
            
                <a href="../object/get_object.html">
            
                    
                    GET Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.3" data-path="../object/put_object.html">
            
                <a href="../object/put_object.html">
            
                    
                    PUT Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4" data-path="../object/append_object.html">
            
                <a href="../object/append_object.html">
            
                    
                    APPEND Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.5" data-path="../object/post_object.html">
            
                <a href="../object/post_object.html">
            
                    
                    POST Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.6" data-path="../object/put_object_copy.html">
            
                <a href="../object/put_object_copy.html">
            
                    
                    PUT Object - Copy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.7" data-path="../object/delete_object.html">
            
                <a href="../object/delete_object.html">
            
                    
                    DELETE Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.8" data-path="../object/get_object_acl.html">
            
                <a href="../object/get_object_acl.html">
            
                    
                    GET Object ACL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.9" data-path="../object/put_object_acl.html">
            
                <a href="../object/put_object_acl.html">
            
                    
                    PUT Object ACL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.10" data-path="../object/initiate_multipart_upload.html">
            
                <a href="../object/initiate_multipart_upload.html">
            
                    
                    Initiate Multipart Upload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.11" data-path="../object/upload_part.html">
            
                <a href="../object/upload_part.html">
            
                    
                    Upload Part
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.12" data-path="../object/upload_part_copy.html">
            
                <a href="../object/upload_part_copy.html">
            
                    
                    Upload Part copy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.13" data-path="../object/complete_multipart_upload.html">
            
                <a href="../object/complete_multipart_upload.html">
            
                    
                    Complete Multipart Upload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.14" data-path="../object/list_parts.html">
            
                <a href="../object/list_parts.html">
            
                    
                    List Parts
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.4.8" data-path="sts.html">
            
                <a href="sts.html">
            
                    
                    STS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../../offline/offline-api.html">
            
                <a href="../../offline/offline-api.html">
            
                    
                    Offline Downloader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../imgx/imgx_manual.html">
            
                <a href="../../imgx/imgx_manual.html">
            
                    
                    Imgx API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../transcoder/">
            
                <a href="../../transcoder/">
            
                    
                    Videos Processing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../transcoder/apis/signing_request.html">
            
                <a href="../../transcoder/apis/signing_request.html">
            
                    
                    Request Signature
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" >
            
                <span>
            
                    
                    Pipeline API
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.1" data-path="../../transcoder/apis/pipeline/create_pipeline.html">
            
                <a href="../../transcoder/apis/pipeline/create_pipeline.html">
            
                    
                    Create Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.2" data-path="../../transcoder/apis/pipeline/get_pipeline.html">
            
                <a href="../../transcoder/apis/pipeline/get_pipeline.html">
            
                    
                    Get Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.3" data-path="../../transcoder/apis/pipeline/list_pipelines.html">
            
                <a href="../../transcoder/apis/pipeline/list_pipelines.html">
            
                    
                    List Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.4" data-path="../../transcoder/apis/pipeline/delete_pipeline.html">
            
                <a href="../../transcoder/apis/pipeline/delete_pipeline.html">
            
                    
                    Delete Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.5" data-path="../../transcoder/apis/pipeline/update_pipeline.html">
            
                <a href="../../transcoder/apis/pipeline/update_pipeline.html">
            
                    
                    Update Pipeline
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.3" >
            
                <span>
            
                    
                    Job API
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.3.1" data-path="../../transcoder/apis/job/create_job.html">
            
                <a href="../../transcoder/apis/job/create_job.html">
            
                    
                    Create Job
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3.2" data-path="../../transcoder/apis/job/get_job.html">
            
                <a href="../../transcoder/apis/job/get_job.html">
            
                    
                    Get Job
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3.3" data-path="../../transcoder/apis/job/list_jobs_by_pipeline.html">
            
                <a href="../../transcoder/apis/job/list_jobs_by_pipeline.html">
            
                    
                    List Job
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3.4" data-path="../../transcoder/apis/job/cancel_job.html">
            
                <a href="../../transcoder/apis/job/cancel_job.html">
            
                    
                    Cancel Job
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../transcoder/apis/metadata.html">
            
                <a href="../../transcoder/apis/metadata.html">
            
                    
                    Metadata
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../../toolkit/">
            
                <a href="../../../toolkit/">
            
                    
                    Toolkit
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../../toolkit/s3-browser.html">
            
                <a href="../../../toolkit/s3-browser.html">
            
                    
                    S3 Browser
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../../console-use/">
            
                <a href="../../../console-use/">
            
                    
                    Console Use
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../../../console-use/console-use.html">
            
                <a href="../../../console-use/console-use.html">
            
                    
                    Baishan Cloud Storage Console Use
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../../all-in-one.html">
            
                <a href="../../../all-in-one.html">
            
                    
                    All-in-One
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >STS</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <!-- mdtoc start -->
<ul>
<li><a href="#provisional-signature&#xFF1A;sts">Provisional signature&#xFF1A;STS</a></li>
<li><a href="#sts&#x4F7F;&#x7528;&#x6D41;&#x7A0B;">STS&#x4F7F;&#x7528;&#x6D41;&#x7A0B;</a><ul>
<li><a href="#example">Example</a></li>
</ul>
</li>
</ul>
<!-- mdtoc end   -->
<h2 id="provisional-signature&#xFF1A;sts">Provisional signature&#xFF1A;STS</h2>
<p>Temporary voucher usage process</p>
<p>After opening the storage account in Baishan cloud storage, you can get the access key and secret key required to access the storage service. This is a permanent access certificate and has any operation permission. Therefore, in order to prevent the disclosure of the permanent certificate, it is not suitable to store it in unsafe places such as mobile clients. When you need to access the storage service from the mobile client, you can use the temporary certificate. At this time, the permanent certificate is stored on the client server. The client server uses the permanent certificate to request the temporary certificate from the Baishan cloud storage node, and then sends the obtained temporary certificate to the mobile client. The mobile client then uses the temporary certificate to access the storage service.</p>
<p>Temporary vouchers include three parts: temporary <code>access_key</code>, temporary <code>secret_key</code>, token. The method of using temporary credentials is similar to that of using permanent credentials, except that an additional token needs to be added. If SDK is used, this token can be passed in through parameters.</p>
<p>Temporary vouchers have a validity period. You can set the length of the validity period when obtaining temporary vouchers, which can be set to 15 minutes to 60 minutes.</p>
<p>The permissions of temporary vouchers can also be set when obtaining them. For example, they can be set to upload only, download only, or upload only to the specified directory.</p>
<h2 id="sts&#x4F7F;&#x7528;&#x6D41;&#x7A0B;">STS&#x4F7F;&#x7528;&#x6D41;&#x7A0B;</h2>
<pre><code>             3            +------------+
  +--------------------&gt;  | Mobile client |
  |                       +------------+
  |                             |
  |                             | 4
  |                             |
  |                 1           v
+------------+ ---------&gt; +--------------------+
| Client server |            | Baishan cloud storage endpoint |
+------------+ &lt;--------- +--------------------+
                   2
</code></pre><ol>
<li><p>The client server accesses the STS service provided by the Baishan cloud storage node to obtain temporary credentials.</p>
</li>
<li><p>The cloud storage STS service returns temporary credentials.</p>
</li>
<li><p>The client server sends temporary credentials to the mobile client.</p>
</li>
<li><p>Mobile clients use temporary credentials to access cloud storage services.</p>
</li>
</ol>
<h3 id="example">Example</h3>
<p><a href="http://sts.ss.bscstorage.com" target="_blank">http://sts.ss.bscstorage.com</a></p>
<ul>
<li>Use the SDK of STS Service to access Baishan cloud storage STS Service. The endpoint is <code>http://sts.ss.bscstorage.com</code></li>
</ul>
<p>The following three parameters are commonly used to apply for temporary vouchers:</p>
<ul>
<li><p><code>Policy</code>: used to describe the allocated permissions. It is a JSON string, which only <code>Statement</code> needs to be filled in field</p>
<ul>
<li><p><code>Effect</code>:<code>Allow</code> indicates allow permission and <code>Deny</code> indicates a refusal.</p>
</li>
<li><p><code>Resource</code>: Used to describe which resources will be assigned permissions, <code>*</code> means for all.</p>
</li>
<li><p><code>Action</code> indicates an action that is rejected or allowed, <code>*</code> means for all.</p>
<ul>
<li><code>s3:GetObject</code></li>
<li><code>s3:GetObjectAcl</code></li>
<li><code>s3:PutObject</code></li>
<li><code>s3:DeleteObject</code></li>
<li><code>s3:PutObjectAcl</code></li>
<li><code>s3:ListMultipartUploadParts</code></li>
<li><code>s3:AbortMultipartUpload</code></li>
<li><code>s3:ListAllMyBuckets</code></li>
<li><code>s3:CreateBucket</code></li>
<li><code>s3:DeleteBucket</code></li>
<li><code>s3:GetBucketVersioning</code></li>
<li><code>s3:GetBucketCORS</code></li>
<li><code>s3:PutBucketAcl</code></li>
<li><code>s3:PutBucketVersioning</code></li>
<li><code>s3:PutBucketCORS</code></li>
<li><code>s3:ListBucket</code></li>
<li><code>s3:ListBucketMultipartUploads</code></li>
<li><code>s3:GetBucketPolicy</code></li>
<li><code>s3:PutBucketPolicy</code></li>
<li><code>s3:DeleteBucketPolicy</code></li>
<li><code>s3:GetBucketAcl</code></li>
</ul>
<p>Eg: &quot;{\&quot;Statement\&quot;:[{\&quot;Resource\&quot;:\&quot;<em>\&quot;,\&quot;Action\&quot;:[\&quot;s3:</em>\&quot;],\&quot;Effect\&quot;:\&quot;Allow\&quot;}]}&quot;&#x8868;&#x793A;&#x5141;&#x8BB8;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#x8BBF;&#x95EE;&#x6240;&#x6709;&#x8D44;&#x6E90;&#x3002;</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>RoleArn: Resource name, string type, user defined, length must be greater than 20.</p>
</li>
<li><p>RoleSessionName: session name, string type, user defined.</p>
</li>
</ul>
<p>Examples of using the Java SDK are as follows:</p>
<pre><code class="lang-java"><span class="hljs-comment">// Generate temporary vouchers from permanent vouchers</span>
String stsEndPoint = <span class="hljs-string">&quot;http://sts.ss.bscstorage.com&quot;</span>;
String accessKey = <span class="hljs-string">&quot;ziwxxxxxxxxxxxxxxxxx&quot;</span>;
String secretKey = <span class="hljs-string">&quot;V+ZTZ5xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>;
BasicAWSCredentials awsCreds = <span class="hljs-keyword">new</span> BasicAWSCredentials(
                accessKey, secretKey);

AWSSecurityTokenService sts = AWSSecurityTokenServiceClientBuilder.standard().withCredentials(
                <span class="hljs-keyword">new</span> AWSStaticCredentialsProvider(awsCreds)).withEndpointConfiguration(
                        <span class="hljs-keyword">new</span> EndpointConfiguration(stsEndPoint, <span class="hljs-string">&quot;us-east-1&quot;</span>)).build();

String policy = <span class="hljs-string">&quot;{\&quot;Statement\&quot;:[{\&quot;Resource\&quot;:\&quot;*\&quot;,\&quot;Action\&quot;:[\&quot;s3:PutObject\&quot;],\&quot;Effect\&quot;:\&quot;Allow\&quot;}]}&quot;</span>

AssumeRoleRequest assumeRoleRequest = <span class="hljs-keyword">new</span> AssumeRoleRequest();
assumeRoleRequest.setPolicy(policy_str);
assumeRoleRequest.setRoleArn(<span class="hljs-string">&quot;arn:aws:iam::123456789:role/test_role&quot;</span>);
assumeRoleRequest.setRoleSessionName(<span class="hljs-string">&quot;test-session&quot;</span>);

AssumeRoleResult assumeRoleResult = sts.assumeRole(assumeRoleRequest);

String tmp_access_key = assumeRoleResult.getCredentials().getAccessKeyId();
String tmp_secret_key = assumeRoleResult.getCredentials().getSecretAccessKey();
String token = assumeRoleResult.getCredentials().getSessionToken();

<span class="hljs-comment">// &#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x7684;&#x4E34;&#x65F6;&#x51ED;&#x8BC1;</span>
String s3EndPoint = <span class="hljs-string">&quot;http://ss.bscstorage.com&quot;</span>;

BasicSessionCredentials sessionCredentials = <span class="hljs-keyword">new</span> BasicSessionCredentials(
                tmp_access_key, tmp_secret_key, token);

AmazonS3 s3 = AmazonS3ClientBuilder.standard().withCredentials(
            <span class="hljs-keyword">new</span> AWSStaticCredentialsProvider(sessionCredentials)).withEndpointConfiguration(
                    <span class="hljs-keyword">new</span> EndpointConfiguration(s3EndPoint, <span class="hljs-string">&quot;us-east-1&quot;</span>)).build();

S3Object obj = s3.getObject(<span class="hljs-string">&quot;bucket&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>);
</code></pre>
<p>Examples of using Python SDK are as follows:</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> boto3

cli = boto3.client(
    <span class="hljs-string">&apos;sts&apos;</span>,
    region_name=<span class="hljs-string">&quot;bj&quot;</span>,
    aws_access_key_id=<span class="hljs-string">&quot;accesskey&quot;</span>,
    aws_secret_access_key=<span class="hljs-string">&quot;secretkey&quot;</span>,
    endpoint_url=<span class="hljs-string">&apos;http://sts.ss.bscstorage.com&apos;</span>
)

policy = <span class="hljs-string">&quot;{\&quot;Statement\&quot;:[{\&quot;Resource\&quot;:\&quot;*\&quot;,\&quot;Action\&quot;:[\&quot;s3:*\&quot;],\&quot;Effect\&quot;:\&quot;Allow\&quot;}]}&quot;</span>
<span class="hljs-comment"># &#x4F7F;&#x7528;&#x6C38;&#x4E45;&#x51ED;&#x8BC1;&#x751F;&#x6210;&#x4E34;&#x65F6;&#x51ED;&#x8BC1;</span>
resp = cli.assume_role(
    DurationSeconds=<span class="hljs-number">3600</span>,
    RoleArn=<span class="hljs-string">&apos;arn:aws:iam::123456789012:role/demo&apos;</span>,
    RoleSessionName=<span class="hljs-string">&quot;test&quot;</span>,
    Policy=policy,
)

print(<span class="hljs-string">&quot;tmp accesskey: %s&quot;</span> % resp[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;AccessKeyId&apos;</span>])
print(<span class="hljs-string">&quot;tmp secretkey: %s&quot;</span> % resp[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;SecretAccessKey&apos;</span>])
print(<span class="hljs-string">&quot;expired time : %s&quot;</span> % resp[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;Expiration&apos;</span>])
print(<span class="hljs-string">&quot;session token: %s&quot;</span> % resp[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;SessionToken&apos;</span>])

<span class="hljs-comment"># &#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x51ED;&#x8BC1;&#x521B;&#x5EFA;client</span>
tmpcli = boto3.client(
    <span class="hljs-string">&quot;s3&quot;</span>,
    region_name=<span class="hljs-string">&quot;bj&quot;</span>,
    aws_access_key_id=resp[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;AccessKeyId&apos;</span>],
    aws_secret_access_key=resp[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;SecretAccessKey&apos;</span>],
    aws_session_token=resp[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;SessionToken&apos;</span>],
    endpoint_url=<span class="hljs-string">&apos;http://ss.bscstorage.com&apos;</span>,
)

<span class="hljs-keyword">print</span> tmpcli.head_object(Bucket=<span class="hljs-string">&apos;bucket&apos;</span>, Key=<span class="hljs-string">&apos;key&apos;</span>)
</code></pre>
<p>Examples of using PHP SDK are as follows:</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">&apos;aws.phar&apos;</span>;

<span class="hljs-keyword">try</span> {
    $cli = <span class="hljs-keyword">new</span> Aws\Sts\StsClient([
        <span class="hljs-string">&apos;version&apos;</span> =&gt; <span class="hljs-string">&apos;latest&apos;</span>,
        <span class="hljs-string">&apos;region&apos;</span> =&gt; <span class="hljs-string">&apos;us-east-1&apos;</span>,
        <span class="hljs-string">&apos;credentials&apos;</span> =&gt; [
            <span class="hljs-string">&apos;key&apos;</span> =&gt; <span class="hljs-string">&apos;accesskey&apos;</span>,
            <span class="hljs-string">&apos;secret&apos;</span> =&gt; <span class="hljs-string">&apos;secretkey&apos;</span>,
        ],
        <span class="hljs-string">&apos;endpoint&apos;</span> =&gt; <span class="hljs-string">&apos;http://sts.ss.bscstorage.com&apos;</span>,
    ]);
    $result = $cli-&gt;assumeRole([
        <span class="hljs-string">&apos;DurationSeconds&apos;</span> =&gt; <span class="hljs-number">3600</span>,
        <span class="hljs-string">&apos;Policy&apos;</span> =&gt; <span class="hljs-string">&quot;{\&quot;Statement\&quot;:[{\&quot;Resource\&quot;:\&quot;*\&quot;,\&quot;Action\&quot;:[\&quot;s3:*\&quot;],\&quot;Effect\&quot;:\&quot;Allow\&quot;}]}&quot;</span>,
        <span class="hljs-string">&apos;RoleArn&apos;</span> =&gt; <span class="hljs-string">&apos;arn:aws:iam::123456789012:role/demo&apos;</span>, <span class="hljs-comment">// REQUIRED</span>
        <span class="hljs-string">&apos;RoleSessionName&apos;</span> =&gt; <span class="hljs-string">&apos;test&apos;</span>, <span class="hljs-comment">// REQUIRED</span>
    ]);

    $tmp_accesskey = $result[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;AccessKeyId&apos;</span>];
    $tmp_secretkey = $result[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;SecretAccessKey&apos;</span>];
    $tmp_sesstoken = $result[<span class="hljs-string">&apos;Credentials&apos;</span>][<span class="hljs-string">&apos;SessionToken&apos;</span>];

    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;tmp accesskey:&quot;</span>, $tmp_accesskey, <span class="hljs-string">&quot;\n&quot;</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;tmp secretkey:&quot;</span>, $tmp_secretkey, <span class="hljs-string">&quot;\n&quot;</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;session token:&quot;</span>, $tmp_sesstoken, <span class="hljs-string">&quot;\n&quot;</span>;

    $s3 = <span class="hljs-keyword">new</span> Aws\S3\S3Client([
        <span class="hljs-string">&apos;version&apos;</span> =&gt; <span class="hljs-string">&apos;latest&apos;</span>,
        <span class="hljs-string">&apos;region&apos;</span> =&gt; <span class="hljs-string">&apos;us-east-1&apos;</span>,
        <span class="hljs-string">&apos;credentials&apos;</span> =&gt; [
            <span class="hljs-string">&apos;key&apos;</span> =&gt; $tmp_accesskey,
            <span class="hljs-string">&apos;secret&apos;</span> =&gt; $tmp_secretkey,
            <span class="hljs-string">&apos;token&apos;</span> =&gt; $tmp_sesstoken,
        ],
        <span class="hljs-string">&apos;endpoint&apos;</span> =&gt; <span class="hljs-string">&apos;http://ss.bscstorage.com&apos;</span>,
    ]);

    $resp = $s3-&gt;getObject([
        <span class="hljs-string">&apos;Bucket&apos;</span> =&gt; <span class="hljs-string">&apos;bucket&apos;</span>,
        <span class="hljs-string">&apos;Key&apos;</span> =&gt; <span class="hljs-string">&apos;key&apos;</span>,
    ]);

    <span class="hljs-keyword">echo</span> $resp;
} <span class="hljs-keyword">catch</span> (\<span class="hljs-keyword">Exception</span> $e) {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Exception: &quot;</span> . $e-&gt;getMessage() . <span class="hljs-string">&quot;\n&quot;</span>;
}
</code></pre>
<p>Examples of using dotnet SDK are as follows:</p>
<pre><code class="lang-csharp"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">StsDemo</span>(<span class="hljs-params"></span>)
</span>{
    AmazonSecurityTokenServiceConfig config = <span class="hljs-keyword">new</span> AmazonSecurityTokenServiceConfig();
    config.ServiceURL = <span class="hljs-string">&quot;http://sts.ss.bscstorage.com&quot;</span>;
    config.SignatureVersion = <span class="hljs-string">&quot;4&quot;</span>;
    AmazonSecurityTokenServiceClient sts = <span class="hljs-keyword">new</span> AmazonSecurityTokenServiceClient(<span class="hljs-string">&quot;accesskey&quot;</span>, <span class="hljs-string">&quot;secretkey&quot;</span>, config);
    <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> sts.AssumeRoleAsync(<span class="hljs-keyword">new</span> AssumeRoleRequest
    {
        Policy = <span class="hljs-string">&quot;{\&quot;Statement\&quot;:[{\&quot;Resource\&quot;:\&quot;*\&quot;,\&quot;Action\&quot;:[\&quot;s3:*\&quot;],\&quot;Effect\&quot;:\&quot;Allow\&quot;}]}&quot;</span>,
        RoleArn = <span class="hljs-string">&quot;arn:aws:iam::123456789012:role/demo&quot;</span>,
        RoleSessionName = <span class="hljs-string">&quot;testAssumeRoleSession&quot;</span>,
    });

    Credentials credentials = response.Credentials;
    Console.WriteLine(<span class="hljs-string">&quot;tmp accesskey:&quot;</span> + credentials.AccessKeyId);
    Console.WriteLine(<span class="hljs-string">&quot;tmp secretkey:&quot;</span> + credentials.SecretAccessKey);
    Console.WriteLine(<span class="hljs-string">&quot;tmp sesstoken:&quot;</span> + credentials.SessionToken);

    AmazonS3Config s3config = <span class="hljs-keyword">new</span> AmazonS3Config();
    s3config.ServiceURL = <span class="hljs-string">&quot;http://ss.bscstorage.com&quot;</span>;
    s3config.SignatureVersion = <span class="hljs-string">&quot;4&quot;</span>;
    AmazonS3Client s3 = <span class="hljs-keyword">new</span> AmazonS3Client(credentials.AccessKeyId, credentials.SecretAccessKey, credentials.SessionToken, s3config);
    <span class="hljs-keyword">var</span> resp = <span class="hljs-keyword">await</span> s3.GetObjectMetadataAsync(<span class="hljs-string">&quot;bucket&quot;</span>, <span class="hljs-string">&quot;key&quot;</span>);
    Console.WriteLine(resp.HttpStatusCode);
}
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../object/list_parts.html" class="navigation navigation-prev " aria-label="Previous page: List Parts">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../offline/offline-api.html" class="navigation navigation-next " aria-label="Next page: Offline Downloader">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"STS","level":"1.4.8","depth":2,"next":{"title":"Offline Downloader","level":"1.5","depth":1,"path":"doc/offline/offline-api.md","ref":"doc/offline/offline-api.md","articles":[]},"previous":{"title":"List Parts","level":"1.4.7.14","depth":3,"path":"doc/s2/object/list_parts.md","ref":"doc/s2/object/list_parts.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"doc/s2/sts/sts.md","mtime":"2022-03-28T06:09:47.196Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-03-28T06:09:48.333Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

